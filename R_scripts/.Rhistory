scale = 1.1, width = 7, height = 5, dpi = 330)
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
rel_widths = c(0.34, 0.16, 0.34, 0,16),
ncol = 4, align = "vh")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
rel_widths = c(0.34, 0.16, 0.34, 0,16),
ncol = 4, nrow = 2, align = "vh")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
ifn_gama_plots$p_bar
ifn_gama_plots$p_qq
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
rel_widths = c(0.34, 0.16, 0.34, 0,16),
ncol = 4, nrow = 2, align = "vh")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0,16),
ncol = 4, nrow = 2, align = "vh")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
ifn_gama_plots$p_bar
papa_plots$p_bar
papa_plots$p_qq
ifn_gama_plots$p_qq
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0.16),
ncol = 4, nrow = 2, align = "vh")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 12, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("N rejected")
p_bar
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("N rejected")
p_bar
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 0, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("N rejected")
p_bar
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0.16),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0.16),
ncol = 4, nrow = 2, align = "v")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0.16),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0.16),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.1, width = 6.5, height = 5, dpi = 330)
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.0, width = 6.5, height = 5, dpi = 330)
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.3, width = 6.5, height = 5, dpi = 330)
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 5, dpi = 330)
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.5, dpi = 330)
get_plots_for_dataset <- function(dataset, tit) {
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("N rejected")
return(list(p_qq = p_qq, p_bar = p_bar))
}
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.34, 0.16, 0.34, 0.16),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.5, dpi = 330)
get_plots_for_dataset <- function(dataset, tit) {
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("")
return(list(p_qq = p_qq, p_bar = p_bar))
}
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.4, 0.1, 0.4, 0.1),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.5, dpi = 330)
get_plots_for_dataset <- function(dataset, tit) {
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("")
return(list(p_qq = p_qq, p_bar = p_bar))
}
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
NULL, NULL,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.5, dpi = 330)
co_culture_plots <- get_plots_for_dataset("frangieh_co_culture_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
NULL, NULL,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.5, dpi = 330)
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.2, dpi = 330)
papa_protein_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (protein) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
co_culture_plots <- get_plots_for_dataset("frangieh_co_culture_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
papa_protein_plots$p_qq, papa_protein_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.2, dpi = 330)
papa_protein_plots <- get_plots_for_dataset("papalexi_eccite_screen_protein", "Papalexi (protein) neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
papa_protein_plots$p_qq, papa_protein_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.2, dpi = 330)
breaks_v <-  seq(1, max_reject, by = if (max_reject >= 4) 2 else 1)
get_plots_for_dataset <- function(dataset, tit) {
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
max_reject <- max(n_bonf_rej$n_reject)
breaks_v <-  seq(1, max_reject, by = if (max_reject >= 4) 2 else 1)
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("")
return(list(p_qq = p_qq, p_bar = p_bar))
}
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
papa_protein_plots <- get_plots_for_dataset("papalexi_eccite_screen_protein", "Papalexi (protein) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
co_culture_plots <- get_plots_for_dataset("frangieh_co_culture_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
papa_protein_plots$p_qq, papa_protein_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.2, dpi = 330)
dataset <- "papalexi_eccite_screen_protein"
tit <- "Papalexi (protein) neg. controls"
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
max_reject <- max(n_bonf_rej$n_reject)
breaks_v <-  seq(1, max_reject, by = if (max_reject >= 6) 2 else 1)
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("")
breaks_v
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = seq(1, max(n_bonf_rej$n_reject), by = 2), expand = c(0, 0)) +
ggtitle("")
get_plots_for_dataset <- function(dataset, tit) {
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
max_reject <- max(n_bonf_rej$n_reject)
breaks_v <-  seq(1, max_reject, by = if (max_reject >= 6) 2 else 1)
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = breaks_v, expand = c(0, 0)) +
ggtitle("")
return(list(p_qq = p_qq, p_bar = p_bar))
}
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
papa_protein_plots <- get_plots_for_dataset("papalexi_eccite_screen_protein", "Papalexi (protein) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
co_culture_plots <- get_plots_for_dataset("frangieh_co_culture_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
papa_protein_plots$p_qq, papa_protein_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.2, dpi = 330)
########################################################
# PANNELS A-D: SCEPTRE vs. Seurat De on several datasets
########################################################
benchmark_res <- undercover_res |>
filter(method %in% c("sceptre", "seurat_de")) |>
mutate(Method = forcats::fct_recode(Method, "SCEPTRE" = "Sceptre"))
get_plots_for_dataset <- function(dataset, tit) {
df_sub <- benchmark_res |> filter(dataset == !!dataset)
p_qq <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.85) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
ggtitle(tit)
n_bonf_rej <- benchmark_res |>
filter(dataset == !!dataset) |>
compute_n_bonf_rejections()
max_reject <- max(n_bonf_rej$n_reject)
breaks_v <-  seq(1, max_reject, by = if (max_reject >= 7) 2 else 1)
p_bar <- n_bonf_rej |> ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank(),
plot.margin = margin(t = 5.5, r = 5.5, b = 5.5, l = 5.5, unit = "pt")) +
scale_y_continuous(breaks = breaks_v, expand = c(0, 0)) +
ggtitle("")
return(list(p_qq = p_qq, p_bar = p_bar))
}
papa_plots <- get_plots_for_dataset("papalexi_eccite_screen_gene", "Papalexi (gene) neg. controls")
papa_protein_plots <- get_plots_for_dataset("papalexi_eccite_screen_protein", "Papalexi (protein) neg. controls")
ifn_gama_plots <- get_plots_for_dataset("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3 neg. controls")
co_culture_plots <- get_plots_for_dataset("frangieh_co_culture_gene", "Frangieh IFN-\u03B3 neg. controls")
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
papa_protein_plots$p_qq, papa_protein_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig_top, device = "png",
scale = 1.2, width = 6.5, height = 4.2, dpi = 330)
p_e <- camp_df |>
filter(dataset == "frangieh_ifn_gamma_gene") |>
ggplot(mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.8) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
my_theme +
theme(legend.title = element_blank(),
legend.position = c(0.32, 0.75),
legend.margin = margin(t = -0.5, unit='cm')) +
guides(color = guide_legend(
keywidth = 0.0,
keyheight = 0.15,
default.unit = "inch")) +
ggtitle("Frangieh IFN-\u03B3 negative controls")
p_f <- camp_df |>
filter(dataset == "papalexi_eccite_screen_gene") |>
ggplot(mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.8) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
my_theme +
theme(legend.title = element_blank(),
legend.position = c(0.32, 0.75),
legend.margin = margin(t = -0.5, unit='cm')) +
guides(color = guide_legend(
keywidth = 0.0,
keyheight = 0.15,
default.unit = "inch")) +
ggtitle("Papalexi (gene modality) negative controls")
fig_bottom <- cowplot::plot_grid(p_e, p_f, ncol = 2, labels = c("d", "e"))
fig_bottom
########################
# CREATE COMBINED FIGURE
########################
fig_bottom <- cowplot::plot_grid(fig_top, fig_bottom, nrow = 2, rel_heights = c(2/3, 1/3))
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig, device = "png",
scale = 1.1, width = 6.75, height = 7, dpi = 330)
fig_top <- cowplot::plot_grid(papa_plots$p_qq, papa_plots$p_bar,
papa_protein_plots$p_qq, papa_protein_plots$p_bar,
ifn_gama_plots$p_qq, ifn_gama_plots$p_bar,
co_culture_plots$p_qq, co_culture_plots$p_bar,
labels = c("a", "", "b", "", "c", "", "d", ""),
rel_widths = c(0.38, 0.12, 0.38, 0.12),
ncol = 4, nrow = 2, align = "h")
fig_bottom <- cowplot::plot_grid(p_e, p_f, ncol = 2, labels = c("d", "e"))
########################
# CREATE COMBINED FIGURE
########################
fig_bottom <- cowplot::plot_grid(fig_top, fig_bottom, nrow = 2, rel_heights = c(2/3, 1/3))
to_save_fp <- paste0(.get_config_path("LOCAL_CODE_DIR"),
"sceptre2-manuscript/R_scripts/figure_creation/fig_3/r_output.png")
ggsave(filename = to_save_fp, plot = fig, device = "png",
scale = 1.1, width = 6.75, height = 7, dpi = 330)
fig_top
fig_bottom
