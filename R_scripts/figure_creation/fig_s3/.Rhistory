filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"))
make_figure_row <- function(dataset, name, print_legend) {
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p_row <- plot_grid(p1, p2, p3, nrow = 1, labels = NULL,
align = "h", rel_widths = c(0.42, 0.42, 0.26))
list(p_row = p_row, legend = legend)
}
# rows 1-3
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", FALSE)
# Load scripts and results
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
source(shared_fig_script)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"))
dataset = "frangieh_ifn_gamma_gene"; name = "Frangieh IFN-\u03B3"; print_legend = FALSE
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p1
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
p2
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p3
bonf_reject_df
compute_n_bonf_rejections(df_sub)
undercover_res <- df_sub
head(undercover_res)
head(undercover_res)
ndercover_res |>
dplyr::group_by(dataset, method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n()))
undercover_res |>
dplyr::group_by(dataset, method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n()))
undercover_res
undercover_res |>
dplyr::group_by(dataset, method)
alpha = 0.1
undercover_res |>
dplyr::group_by(dataset, method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n()))
undercover_res |>
dplyr::group_by(dataset, method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n())) |>
dplyr::summarize(n_reject = sum(reject))
undercover_res |>
dplyr::group_by(dataset, method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n()))
n_bonf_rej <- undercover_res |>
dplyr::group_by(dataset, method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n())) |>
dplyr::summarize(n_reject = sum(reject)) |>
dplyr::ungroup() |>
lowmoi:::update_dataset_and_method_names()
n_bonf_rej
load_all()
# Load scripts and results
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
# rows 1-3
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", FALSE)
# Load packages
library(tidyverse)
library(katlabutils)
library(cowplot)
# Load scripts and results
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
source(shared_fig_script)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"))
dataset <- "frangieh_ifn_gamma_gene"
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
bonf_reject_df
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p3
# Load scripts and results
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
source(shared_fig_script)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"))
make_figure_row <- function(dataset, name, print_legend) {
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p_row <- plot_grid(p1, p2, p3, nrow = 1, labels = NULL,
align = "h", rel_widths = c(0.42, 0.42, 0.26))
list(p_row = p_row, legend = legend)
}
# rows 1-3
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", FALSE)
r1
dataset <- "frangieh_ifn_gamma_gene"
name <- "Frangieh IFN-\u03B3"
print_legend <- FALSE
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p1
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
p2
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
bonf_reject_df
head(df_sub)
df_sub$Method |> unique()
df_sub$Method |> levels()
df_sub$Method |> unique()
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
bonf_reject_df
df_sub$Method |> unique()
# Load scripts and results
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
bonf_reject_df
# Load scripts and results
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
source(shared_fig_script)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"))
dataset <- "frangieh_ifn_gamma_gene"
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p_row <- plot_grid(p1, p2, p3, nrow = 1, labels = NULL,
align = "h", rel_widths = c(0.42, 0.42, 0.26))
p3
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
df_sub$Method |> levels()
undercover_res |> mutate(Method = fct_relevel("SCEPTRE"))
undercover_res |> mutate(Method = fct_relevel("SCEPTRE")) |> pull(Method) |> levels()
?fct_reorder
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"))
undercover_res$Method |> head()
undercover_res$Method |> fct_relevel("SCEPTRE") |> head()
undercover_res$Method |> fct_relevel("SCEPTRE") |> levels()
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"),
Method = fct_relevel(Method, "SCEPTRE"))
undercover_res$Method |> levels()
# rows 1-3
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", FALSE)
r1
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_1_processed.rds")) |>
filter(n_nonzero_treatment >= 7, n_nonzero_control >= 7) |>
mutate(Method = fct_recode(Method, "SCEPTRE" = "Sceptre"),
Method = fct_relevel(Method, "SCEPTRE", after = Inf))
make_figure_row <- function(dataset, name, print_legend) {
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = "bottom",
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p_row <- plot_grid(p1, p2, p3, nrow = 1, labels = NULL,
align = "h", rel_widths = c(0.42, 0.42, 0.26))
list(p_row = p_row, legend = legend)
}
# rows 1-3
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", FALSE)
r1
# figure for gene's grant proposal
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", TRUE)
r1$legend
r1$legend |> plot()
# figure for gene's grant proposal
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", TRUE, "right")
make_figure_row <- function(dataset, name, print_legend, legend_posit = "bottom") {
my_methods <- c("Weissman Method", "Schraivogel Method", "Mimosca", "Liscovitch Method", "Seurat De", "SCEPTRE")
my_values <- my_cols[names(my_cols) %in% my_methods]
df_sub <- undercover_res |>
filter(dataset == !!dataset,
Method %in% my_methods)
p1 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_reverse() +
scale_y_reverse() +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") +
scale_color_manual(values = my_values) +
ggtitle(paste0("QQ-plot (", name, ")")) +
my_theme +
theme(legend.title= element_blank(),
legend.position = legend_posit,
legend.text=element_text(size=9),
legend.margin=margin(t = 0, unit='cm'))
legend <- cowplot::get_legend(p1)
p1 <- p1 + my_theme_no_legend
p2 <- ggplot(data = df_sub, mapping = aes(y = p_value, col = Method)) +
stat_qq_points(ymin = 1e-8, size = 0.55) +
stat_qq_band() +
scale_x_continuous(trans = revlog_trans(10)) +
scale_y_continuous(trans = revlog_trans(10)) +
labs(x = "Expected null p-value", y = "Observed p-value") +
geom_abline(col = "black") + my_theme_no_legend +
scale_color_manual(values = my_values) +
ggtitle("Transformed QQ-plot")
bonf_reject_df <- compute_n_bonf_rejections(df_sub) |>
dplyr::mutate(n_reject = ifelse(n_reject == 0, 0.2, n_reject))
p3 <- bonf_reject_df |>
ggplot2::ggplot(ggplot2::aes(x = Method, y = n_reject, fill = Method)) +
ggplot2::geom_col(col = "black") +
scale_y_continuous(trans=scales::pseudo_log_trans(base = 10, sigma = 0.2),
expand = c(0,0),
breaks = c(0, 1, 10, 100, 1000, 8000)) +
ylab("N Bonferoni rejections") +
xlab("Method") + my_theme_no_legend +
theme(axis.text.x = element_blank()) +
scale_fill_manual(values = my_cols) +
ggtitle("N rejections")
p_row <- plot_grid(p1, p2, p3, nrow = 1, labels = NULL,
align = "h", rel_widths = c(0.42, 0.42, 0.26))
list(p_row = p_row, legend = legend)
}
# figure for gene's grant proposal
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh IFN-\u03B3", TRUE, "right")
r1$legend |> plot()
gene_fig <- plot_grid(r1, r1$legend, rel_widths = c(0.9, 0.1))
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.9, 0.1))
gene_fig
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1, width = 7, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.8, 0.2))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1, width = 7, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.78, 0.22))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1, width = 7, height = 3)
# figure for gene's grant proposal
r1 <- make_figure_row("frangieh_ifn_gamma_gene", "Frangieh", TRUE, "right")
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.78, 0.22))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1, width = 7, height = 3)
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.8, 0.2))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.85, 0.15))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.9, 0.1))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.85, 0.15))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.84, 0.16))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
gene_fig <- plot_grid(r1$p_row, r1$legend, rel_widths = c(0.83, 0.17))
ggsave(filename = "~/Desktop/gene_proposal_fig.pdf", plot = gene_fig, device = "pdf", scale = 1.1, width = 8, height = 3)
