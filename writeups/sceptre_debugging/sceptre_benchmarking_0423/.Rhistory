load_all()
undercover_res_sub
rlang::last_trace()
library(katlabutils)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds")) |> na.omit()
undercover_res_sub <- undercover_res |> dplyr::filter(dataset == "papalexi/eccite_screen/protein")
undercover_res_sub
undercover_res_sub <- undercover_res |> dplyr::filter(dataset == "papalexi/eccite_screen/protein")
head(undercover_res_sub)
undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < 0.1/n()))
compute_n_bonf_rejections
library(katlabutils)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
source(shared_fig_script)
compute_n_bonf_rejections(undercover_res = undercover_res_sub)
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds")) |>
na.omit() |>
dplyr::mutate(Method = method)
head(undercover_res)
undercover_res_sub <- undercover_res |> dplyr::filter(dataset == "papalexi/eccite_screen/protein")
ggplot2::ggplot(data = undercover_res_sub,
mapping = ggplot2::aes(y = p_value, col = method)) +
stat_qq_points(ymin = 1e-8, size = 0.55, alpha = 0.9) +
stat_qq_band() +
ggplot2::scale_x_continuous(trans = revlog_trans(10)) +
ggplot2::scale_y_continuous(trans = revlog_trans(10)) +
ggplot2::labs(x = "Expected null p-value", y = "Observed p-value") +
ggplot2::geom_abline(col = "black") +
theme(legend.position = "bottom") +
theme_bw()
compute_n_bonf_rejections(undercover_res = undercover_res_sub)
compute_n_bonf_rejections(undercover_res = undercover_res_sub)
compute_n_bonf_rejections
undercover_res_sub |>
dplyr::group_by(method)
undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(reject = (p_value < alpha/dplyr::n()),
Method = Method[1])
undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < alpha/dplyr::n()))
undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < 0.1/dplyr::n()))
n_reject_df <- undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < 0.1/dplyr::n()))
source(shared_fig_script)
n_reject_df
n_reject_df <- undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < 0.1/dplyr::n()))
n_reject_df <- undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < 0.1/dplyr::n()))
print(n_reject_df)
p <- ggplot2::ggplot(data = undercover_res_sub,
mapping = ggplot2::aes(y = p_value, col = method)) +
stat_qq_points(ymin = 1e-8, size = 0.55, alpha = 0.9) +
stat_qq_band() +
ggplot2::scale_x_continuous(trans = revlog_trans(10)) +
ggplot2::scale_y_continuous(trans = revlog_trans(10)) +
ggplot2::labs(x = "Expected null p-value", y = "Observed p-value") +
ggplot2::geom_abline(col = "black") +
theme(legend.position = "bottom") +
theme_bw()
p
p <- ggplot2::ggplot(data = undercover_res_sub,
mapping = ggplot2::aes(y = p_value, col = method)) +
stat_qq_points(ymin = 1e-8, size = 0.55, alpha = 0.9) +
stat_qq_band() +
ggplot2::scale_x_continuous(trans = revlog_trans(10)) +
ggplot2::scale_y_continuous(trans = revlog_trans(10)) +
ggplot2::labs(x = "Expected null p-value", y = "Observed p-value") +
ggplot2::geom_abline(col = "black") +
theme_bw()
p
load_all()
analyze_dataset <- function(undercover_res, dataset) {
undercover_res_sub <- undercover_res |>
dplyr::filter(dataset == !!dataset)
p <- ggplot2::ggplot(data = undercover_res_sub,
mapping = ggplot2::aes(y = p_value, col = method)) +
stat_qq_points(ymin = 1e-8, size = 0.55, alpha = 0.9) +
stat_qq_band() +
ggplot2::scale_x_continuous(trans = revlog_trans(10)) +
ggplot2::scale_y_continuous(trans = revlog_trans(10)) +
ggplot2::labs(x = "Expected null p-value", y = "Observed p-value") +
ggplot2::geom_abline(col = "black") +
theme_bw()
n_reject_df <- undercover_res_sub |>
dplyr::group_by(method) |>
dplyr::summarize(n_reject = sum(p_value < 0.1/dplyr::n()))
print(n_reject_df)
}
undercover_res$dataset |> unique?*()
undercover_res$dataset |> unique()
analyze_dataset(undercover_res = undercover_res,
dataset = "frangieh/co_culture/gene")
undercover_res$dataset |> unique()
undercover_res$dataset |> unique() |> paste0(collapse = ", ")
?forcats::fct_recode
head(undercover_res)
undercover_res$method |> unique()
undercover_res$dataset |> unique()
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds")) |>
na.omit() |>
forcats::fct_recode(method,
schraivogel_enh = "schraivogel/enhancer_screen_chr11/gene",
schraivogel_enh = "schraivogel/enhancer_screen_chr8/gene")
undercover_res$method |> class()
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds")) |>
na.omit() |>
dplyr::mutate(method = forcats::fct_recode(method,
schraivogel_enh = "schraivogel/enhancer_screen_chr11/gene",
schraivogel_enh = "schraivogel/enhancer_screen_chr8/gene"))
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds"))
head(undercover_res)
undercover_res$dataset |> unique()
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds")) |>
na.omit() |>
dplyr::mutate(method = forcats::fct_recode(method,
schraivogel_enh = "schraivogel/enhancer_screen_chr11/gene",
schraivogel_enh = "schraivogel/enhancer_screen_chr8/gene"))
head(undercover_res)
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/sceptre_benchmark_0423.rds")) |>
na.omit() |>
dplyr::mutate(dataset = forcats::fct_recode(dataset,
schraivogel_enh = "schraivogel/enhancer_screen_chr11/gene",
schraivogel_enh = "schraivogel/enhancer_screen_chr8/gene"))
analyze_dataset <- function(undercover_res, dataset) {
undercover_res_sub <- undercover_res |>
dplyr::filter(dataset == !!dataset)
undercover_res$dataset |> unique()
library(katlabutils)
library(tidyverse)
knitr::opts_chunk$set(echo = TRUE)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
shared_fig_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/R_scripts/figure_creation/shared_figure_script.R")
source(shared_fig_script)
analyze_dataset(undercover_res = undercover_res,
dataset = "frangieh/co_culture/gene")
analyze_dataset(undercover_res = undercover_res,
dataset = "frangieh/ifn_gamma/gene")
analyze_dataset(undercover_res = undercover_res,
dataset = "frangieh/control/gene")
analyze_dataset(undercover_res = undercover_res,
dataset = "simulated/experiment_1/gene")
analyze_dataset(undercover_res = undercover_res,
dataset = "schraivogel_enh")
analyze_dataset(undercover_res = undercover_res,
dataset = "papalexi/eccite_screen/gene")
analyze_dataset(undercover_res = undercover_res,
dataset = "papalexi/eccite_screen/protein")
pc_res <- readRDS(paste0(result_dir, "positive_control_analysis/sceptre_benchmark_0423.rds"))
reject_threshes <- c(1e-3, 1e-4, 1e-5, 1e-6, 1e-7)
make_barplot <- function(pc_res, reject_thresh) {
pc_res |> na.omit() |>
group_by(dataset, method) |>
summarize(n_pc_reject = sum(p_value < reject_thresh))
pc_res |> na.omit() |>
group_by(dataset, method) |>
summarize(n_pc_reject = sum(p_value < reject_thresh))
reject_thresh <- 0.1
pc_res |> na.omit() |>
group_by(dataset, method) |>
summarize(n_pc_reject = sum(p_value < reject_thresh))
pc_res |> na.omit() |>
group_by(dataset, method) |>
summarize(n_pc_reject = sum(p_value < 1e-5))
