sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point() +
facet_wrap(dataset ~ .)
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point() +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw()
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size)
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size)
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size)
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point() +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw()
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw()
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero treatment")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero treatment")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero treatment")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_control)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero control")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(n_nonzero_treatment, n_nonzero_control)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero control")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |> head()
head(sample_size_df)
head(sample_size_df)
sample_size_df |>
select(-effective_samp_size) |>
pivot_longer(cols = c("n_nonzero_treatment",
"n_nonzero_control")) |> head()
sample_size_df |>
select(-effective_samp_size) |>
pivot_longer(cols = c("n_nonzero_treatment",
"n_nonzero_control"),
names_to = "metric",
values_to = "count")
x <- sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
pivot_longer(cols = c("n_nonzero_treatment",
"n_nonzero_control"),
names_to = "metric",
values_to = "count")
head(x)
nrow(x)
tail(x)
x
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE)
head(x)
x |>
ggplot(mapping = aes(x = count)) +
geom_boxplot() +
facet_wrap(dataset ~ ., scales = "free")
x |>
ggplot(mapping = aes(y = count, col = metric)) +
geom_boxplot() +
facet_wrap(dataset ~ ., scales = "free")
x <- sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE)
head(x)
x |>
ggplot(mapping = aes(y = n_nonzero_control, col = metric)) +
geom_boxplot() +
facet_wrap(dataset ~ .)
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_boxplot() +
facet_wrap(dataset ~ .)
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_boxplot() +
facet_wrap(dataset ~ .) +
scale_y_log10()
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size) |>
update_dataset_names()
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size) |>
mutate(method = factor("NA"))
update_dataset_names()
update_dataset_names
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size) |>
mutate(dataset_rename = stringr::str_to_title(gsub(pattern = "_",
replacement = " ", x = dataset)))
head(sample_size_df)
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_boxplot() +
facet_wrap(dataset_rename ~ ., labeller = label_wrap_gen(35)) +
scale_y_log10()
x <- sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE)
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_boxplot() +
facet_wrap(dataset_rename ~ ., labeller = label_wrap_gen(35)) +
scale_y_log10()
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_violin() +
facet_wrap(dataset_rename ~ ., labeller = label_wrap_gen(35)) +
scale_y_log10()
x |>
ggplot(mapping = aes(x = n_nonzero_control)) +
geom_violin() +
facet_wrap(dataset_rename ~ ., labeller = label_wrap_gen(35)) +
scale_y_log10()
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_violin()
x |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_boxplot() +
facet_wrap(dataset_rename ~ ., ) +
scale_y_log10()
sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(y = n_nonzero_control)) +
geom_boxplot() +
facet_wrap(dataset_rename ~ ., ) +
scale_y_log10()
sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(y = n_nonzero_control, x = dataset_rename)) +
geom_boxplot() +
scale_y_log10()
sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(y = n_nonzero_control, x = dataset_rename)) +
geom_boxplot() +
scale_y_log10() +
ylab("N nonzero control") +
xlab("")
sample_size_df |>
select(-effective_samp_size) |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(y = n_nonzero_control, x = dataset_rename)) +
geom_boxplot() +
scale_y_log10() +
ylab("N nonzero control") +
xlab("") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
knitr::opts_chunk$set(echo = TRUE)
library(katlabutils)
library(tidyverse)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id) |>
filter(grna_group == "non-targeting") |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
filter(dataset %in% c("frangieh_co_culture_gene",
"frangieh_control_gene",
"frangieh_ifn_gamma_gene",
"papalexi_eccite_screen_gene",
"schraivogel_enhancer_screen",
"schraivogel_ground_truth_perturbseq_gene",
"schraivogel_ground_truth_tapseq_gene"))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
sample_size_df <- left_join(x = sample_size_df,
y = ntc_effective_samp_size,
by = c("response_id", "dataset")) |>
mutate(n_nonzero_treatment = n_nonzero_cells,
n_nonzero_control = effective_samp_size - n_nonzero_cells) |>
select(response_id,
undercover_grna = grna_id,
n_nonzero_treatment,
n_nonzero_control,
dataset,
effective_samp_size) |>
mutate(dataset_rename = stringr::str_to_title(gsub(pattern = "_",
replacement = " ", x = dataset)))
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_treatment)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero treatment")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(effective_samp_size, n_nonzero_control)) +
geom_point(alpha = 0.7, cex = 0.7) +
facet_wrap(dataset ~ ., scales = "free") +
theme_bw() +
xlab("Effective sample size") +
ylab("N nonzero control")
sample_size_df |>
group_by(dataset) |>
sample_n(10000, replace = TRUE) |>
ggplot(mapping = aes(y = n_nonzero_treatment, x = dataset_rename)) +
geom_boxplot() +
scale_y_log10() +
ylab("N nonzero treatment") +
xlab("") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
