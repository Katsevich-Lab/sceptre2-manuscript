facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_discrete(name = "p < 0.001")
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_discrete(name = "p < 0.001") + scale_color_manual(c("darkred", "darkblue"))
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_discrete(name = "p < 0.001") + scale_color_manual(values = c("darkred", "darkblue"))
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
+ scale_color_manual(values = c("darkred", "darkblue")) + scale_color_discrete(name = "p < 0.001") +
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
+ scale_color_manual(values = c("darkred", "darkblue")) + scale_color_discrete(name = "p < 0.001")
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
+ scale_color_manual(values = c("darkred", "darkblue")) + scale_color_discrete(name = "p < 0.001")
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + scale_color_discrete(name = "p < 0.001")
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color='NEW LEGEND TITLE')
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001")
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = p_value <= 0.001) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001]))
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001")
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = ifelse(p_value <= 0.001, "yes", "no")) |>
mutate(p_lt_001 = factor(p_lt_001, levels = c("yes", "no"), labels = c("yes", "no"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001]))
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.8) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001")
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = ifelse(p_value <= 0.001, "yes", "no")) |>
mutate(p_lt_001 = factor(p_lt_001, levels = c("yes", "no"), labels = c("yes", "no"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001]))
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point() + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001")
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = ifelse(p_value <= 0.001, "yes", "no")) |>
mutate(p_lt_001 = factor(p_lt_001, levels = c("no", "yes"), labels = c("no", "yes"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001]))
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point() + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001")
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = ifelse(p_value <= 0.001, "yes", "no")) |>
mutate(p_lt_001 = factor(p_lt_001, levels = c("no", "yes"), labels = c("no", "yes"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001])) |>
arrange(p_lt_001)
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point() + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001")
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_hline(qc_thresh)
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = ifelse(p_value <= 0.001, "yes", "no")) |>
mutate(p_lt_001 = factor(p_lt_001, levels = c("no", "yes"), labels = c("no", "yes"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001])) |>
arrange(p_lt_001)
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_vline(aes(xintercept = qc_thresh))
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = ifelse(p_value <= 0.001, "yes", "no")) |>
mutate(p_lt_001 = factor(p_lt_001, levels = c("no", "yes"), labels = c("no", "yes"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001])) |>
arrange(p_lt_001) |>
ungroup()
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_vline(aes(xintercept = qc_thresh))
to_plot |>
filter(method == "fisher_exact") |> head()
to_plot <- pc_res_singleton_w_samp_size_2 |>
mutate(p_lt_001 = p_value <= 0.001) |>
mutate(p_lt_001_f = factor(p_lt_001, levels = c(FALSE, TRUE), labels = c("no", "yes"))) |>
group_by(method, dataset) |>
mutate(qc_thresh = min(effective_sample_size[p_lt_001])) |>
arrange(p_lt_001) |>
ungroup()
to_plot |> head()
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_vline(aes(xintercept = qc_thresh))
head(to_plot)
to_plot |>
filter(method == "fisher_exact") |> arrnange(qc_thresh)
to_plot |>
filter(method == "fisher_exact") |> arrange(qc_thresh)
to_plot |>
filter(method == "fisher_exact") |> arrange(qc_thresh) |> head()
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + xlim(c(0, NA)) + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_vline(aes(xintercept = qc_thresh))
to_plot$qc_thresh |> min()
to_plot$qc_thresh |> unique() |> sort()
to_plot$qc_thresh |> unique() |> sort() |> head(10)
thresh <- 250
thresh
to_plot |>
filter(method == "fisher_exact") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + xlim(c(0, NA)) + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_vline(aes(xintercept = qc_thresh))
to_plot |>
filter(method == "seurat_de") |>
ggplot(mapping = aes(x = effective_sample_size,
y = p_value,
col = p_lt_001)) +
facet_wrap(dataset_rename_w_pairs ~ ., scales = "free", labeller = label_wrap_gen(35)) +
geom_point(size = 0.85) + xlab("Effective sample size") + ylab("p-value") + xlim(c(0, NA)) + theme_bw() +
scale_color_manual(values = c("darkred", "darkblue")) + labs(color = "p < 0.001") + geom_vline(aes(xintercept = qc_thresh))
?wilcox.test
sample_size_df
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
head(ntc_effective_samp_size)
effective_samp_size_thresh <- 250
effective_samp_size_thresh <- 250
p <- ggplot(data = ntc_effective_samp_size,
mapping = aes(x = effective_samp_size)) +
geom_histogram() + facet_wrap(dataset~., scales ="free") +
theme_bw() +
xlab("Effective sample size") +
ylab("Count") +
scale_x_log10() + geom_vline(xintercept = effective_samp_size_thresh, col = "darkred")
p
effective_sample_size_thresh <- 250
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
mean(ntc_effective_samp_size$effective_samp_size >= effective_sample_size_thresh)
head(undercover_res)
undercover_res_w_samp_size <- dplyr::left_join(undercover_res,
ntc_effective_samp_size, by = c("response_id", "dataset"))
undercover_res_w_samp_size <- dplyr::left_join(undercover_res,
ntc_effective_samp_size, by = c("response_id", "dataset"))
make_trans_qq_plot(undercover_res_w_samp_size)
head(undercover_res)
undercover_res$dataset |> unique()
undercover_res <-
rbind(undercover_res |> filter(!(dataset %in%
c("liscovitch_experiment_big_chromatin",
"liscovitch_experiment_small_chromatin"))),
fisher_exact_res_plot)
undercover_res_w_samp_size <- dplyr::left_join(undercover_res,
ntc_effective_samp_size, by = c("response_id", "dataset"))
undercover_res <-
rbind(undercover_res |> filter(!(dataset %in%
c("liscovitch_experiment_big_chromatin",
"liscovitch_experiment_small_chromatin"))),
fisher_exact_res_plot)
undercover_res_w_samp_size <- dplyr::left_join(undercover_res,
ntc_effective_samp_size, by = c("response_id", "dataset"))
make_trans_qq_plot(undercover_res_w_samp_size)
heaed(undercover_res_w_samp_size)
head(undercover_res_w_samp_size)
# load packages
library(tidyverse)
library(katlabutils)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
# load the auxilliary functions
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
# 1. Fisher exact test negative control results
fisher_exact_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/fisher_exact_1.rds"))
# 2. Positive control results
pc_res <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results.rds"))
# 3. sample size information df
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id)
# 4. undercover results (excluding Fisher) for group size = 1
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1.rds")) |>
dplyr::select(-clock_time, -max_ram) |>
dplyr::filter(method %in% c("seurat_de", "liscovitch_method", "schraivogel_method", "weissman_method", "mimosca"))
# 5. undercover result sceptre (rbind with above undercover results)
undercover_res_sceptre <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1_sceptre.rds")) |>
dplyr::select(-clock_time, -max_ram)
undercover_res <- rbind(undercover_res, undercover_res_sceptre)
# 6. singleton positive control results
pc_res_singleton <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results_singleton.rds")) |> rename("grna_id" = "grna_group")
# 7. undercover group size half (on Schraivogel perturb-seq data) results
undercover_res_grp_size_half <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_half_schraivogel_perturb_seq.rds"))
effective_sample_size_thresh <- 250
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
mean(ntc_effective_samp_size$effective_samp_size >= effective_sample_size_thresh)
undercover_res_w_samp_size <-
rbind(undercover_res |> filter(!(dataset %in%
c("liscovitch_experiment_big_chromatin",
"liscovitch_experiment_small_chromatin"))),
fisher_exact_res_plot) |>
left_join(ntc_effective_samp_size, by = c("response_id", "dataset"))
library(tidyverse)
library(katlabutils)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
# load the auxilliary functions
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
# 1. Fisher exact test negative control results
fisher_exact_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/fisher_exact_1.rds"))
# 2. Positive control results
pc_res <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results.rds"))
# 3. sample size information df
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id)
# 4. undercover results (excluding Fisher) for group size = 1
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1.rds")) |>
dplyr::select(-clock_time, -max_ram) |>
dplyr::filter(method %in% c("seurat_de", "liscovitch_method", "schraivogel_method", "weissman_method", "mimosca"))
# 5. undercover result sceptre (rbind with above undercover results)
undercover_res_sceptre <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1_sceptre.rds")) |>
dplyr::select(-clock_time, -max_ram)
undercover_res <- rbind(undercover_res, undercover_res_sceptre)
# 6. singleton positive control results
pc_res_singleton <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results_singleton.rds")) |> rename("grna_id" = "grna_group")
# 7. undercover group size half (on Schraivogel perturb-seq data) results
undercover_res_grp_size_half <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_half_schraivogel_perturb_seq.rds"))
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
fisher_exact_res_plot <- fisher_exact_res |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names(TRUE)
sample_size_df <-
sample_size_df |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens()
pc_res <- pc_res |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names()
pc_res_singleton <- pc_res_singleton |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names()
undercover_res <- undercover_res |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names()
undercover_res_grp_size_half <- undercover_res_grp_size_half |>
replace_slash_w_underscore() |>
update_dataset_names()
effective_sample_size_thresh <- 250
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
mean(ntc_effective_samp_size$effective_samp_size >= effective_sample_size_thresh)
undercover_res_w_samp_size <-
rbind(undercover_res |> filter(!(dataset %in%
c("liscovitch_experiment_big_chromatin",
"liscovitch_experiment_small_chromatin"))),
fisher_exact_res_plot) |>
left_join(ntc_effective_samp_size, by = c("response_id", "dataset"))
make_trans_qq_plot(undercover_res_w_samp_size)
undercover_res_w_samp_size |>
filter(effective_samp_size >= 250) |>
make_trans_qq_plot()
make_trans_qq_plot
library(tidyverse)
library(katlabutils)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
# load the auxilliary functions
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
# 1. Fisher exact test negative control results
fisher_exact_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/fisher_exact_1.rds"))
# 2. Positive control results
pc_res <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results.rds"))
# 3. sample size information df
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id)
# 4. undercover results (excluding Fisher) for group size = 1
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1.rds")) |>
dplyr::select(-clock_time, -max_ram) |>
dplyr::filter(method %in% c("seurat_de", "liscovitch_method", "schraivogel_method", "weissman_method", "mimosca"))
# 5. undercover result sceptre (rbind with above undercover results)
undercover_res_sceptre <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1_sceptre.rds")) |>
dplyr::select(-clock_time, -max_ram)
undercover_res <- rbind(undercover_res, undercover_res_sceptre)
# 6. singleton positive control results
pc_res_singleton <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results_singleton.rds")) |> rename("grna_id" = "grna_group")
# 7. undercover group size half (on Schraivogel perturb-seq data) results
undercover_res_grp_size_half <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_half_schraivogel_perturb_seq.rds"))
undercover_res_w_samp_size |>
filter(effective_samp_size >= 750) |>
make_trans_qq_plot()
make_trans_qq_plot
# load packages
library(tidyverse)
library(katlabutils)
result_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
# load the auxilliary functions
funct_script <- paste0(.get_config_path("LOCAL_CODE_DIR"), "sceptre2-manuscript/writeups/undercover_results_eda/analyze_undercover_results_plot_functs.R")
source(funct_script)
# 1. Fisher exact test negative control results
fisher_exact_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/fisher_exact_1.rds"))
# 2. Positive control results
pc_res <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results.rds"))
# 3. sample size information df
sample_size_df <- readRDS(paste0(result_dir, "dataset_sample_sizes/n_nonzero_cells_per_grna.rds")) |>
dplyr::mutate(dataset = dataset_concat,
dataset_concat = NULL, paper = NULL, modality = NULL) |>
dplyr::rename(grna_group = target, response_id = feature_id)
# 4. undercover results (excluding Fisher) for group size = 1
undercover_res <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1.rds")) |>
dplyr::select(-clock_time, -max_ram) |>
dplyr::filter(method %in% c("seurat_de", "liscovitch_method", "schraivogel_method", "weissman_method", "mimosca"))
# 5. undercover result sceptre (rbind with above undercover results)
undercover_res_sceptre <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_1_sceptre.rds")) |>
dplyr::select(-clock_time, -max_ram)
undercover_res <- rbind(undercover_res, undercover_res_sceptre)
# 6. singleton positive control results
pc_res_singleton <- readRDS(paste0(result_dir, "positive_control_analysis/pc_results_singleton.rds")) |> rename("grna_id" = "grna_group")
# 7. undercover group size half (on Schraivogel perturb-seq data) results
undercover_res_grp_size_half <- readRDS(paste0(result_dir, "undercover_grna_analysis/undercover_result_grp_size_half_schraivogel_perturb_seq.rds"))
replace_slash_w_underscore <- function(df) {
df |> dplyr::mutate(dataset = gsub(pattern = "/",
replacement = "_",
fixed = TRUE,
x = dataset))
}
fisher_exact_res_plot <- fisher_exact_res |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names(TRUE)
sample_size_df <-
sample_size_df |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens()
pc_res <- pc_res |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names()
pc_res_singleton <- pc_res_singleton |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names()
undercover_res <- undercover_res |>
replace_slash_w_underscore() |>
combine_schraivogel_enhancer_screens() |>
update_dataset_names()
undercover_res_grp_size_half <- undercover_res_grp_size_half |>
replace_slash_w_underscore() |>
update_dataset_names()
effective_sample_size_thresh <- 250
ntc_effective_samp_size <- sample_size_df |>
filter(grna_group == "non-targeting") |>
group_by(response_id, dataset) |>
summarize(effective_samp_size = sum(n_nonzero_cells))
mean(ntc_effective_samp_size$effective_samp_size >= effective_sample_size_thresh)
undercover_res_w_samp_size
undercover_res_w_samp_size <-
rbind(undercover_res |> filter(!(dataset %in%
c("liscovitch_experiment_big_chromatin",
"liscovitch_experiment_small_chromatin"))),
fisher_exact_res_plot) |>
left_join(ntc_effective_samp_size, by = c("response_id", "dataset"))
sample_size_df |>
filter(grna_group == "non-targeting") |> head()
head(ntc_effective_samp_size)
undercover_res_w_samp_size |>
filter(effective_samp_size >= 250) |> head()
undercover_res_w_samp_size |>
filter(effective_samp_size >= 250) |>
select(-Method, dataset_rename_w_pairs, -effective_samp_size, -n_pairs) |>
head()
undercover_res_w_samp_size |>
filter(effective_samp_size >= 250) |>
select(-Method, -dataset_rename_w_pairs, -effective_samp_size, -n_pairs) |>
head()
undercover_res_w_samp_size |>
filter(effective_samp_size >= 250) |>
select(-Method, -dataset_rename_w_pairs, -effective_samp_size, -n_pairs) |>
update_dataset_names(TRUE) |>
head()
mean(ntc_effective_samp_size$effective_samp_size >= 750)
