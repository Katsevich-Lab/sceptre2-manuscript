---
title: "Comparing effective sample sizes across negative control and discovery pairs"
author: "Tim"
date: "2023-04-24"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

In this short writeup I compare the number of nonzero treatment cells (per pair) across negative control and discovery sets.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
sceptre2_results_dir <- paste0(.get_config_path("LOCAL_SCEPTRE2_DATA_DIR"), "results/")
undercover_res <- readRDS(paste0(sceptre2_results_dir, "undercover_grna_analysis/undercover_result_grp_1_0423_processed.rds"))
discovery_res <- readRDS(paste0(sceptre2_results_dir, "discovery_analyses/discovery_results_0423_processed.rds"))

undercover_ss <- undercover_res |> 
  dplyr::filter(method == "sceptre",
                dataset %in% c("frangieh_control_gene", "papalexi_eccite_screen_gene")) |>
  na.omit() |> dplyr::select(n_nonzero_treatment, n_nonzero_control, dataset) |>
  dplyr::mutate(pair_type = "neg_cntrl" |> factor())
discovery_ss <- discovery_res |>
  dplyr::filter(method == "sceptre",
                dataset %in% c("frangieh_control_gene", "papalexi_eccite_screen_gene")) |>
  na.omit() |> dplyr::select(n_nonzero_treatment = n_treatment,
                             n_nonzero_control = n_control,
                             dataset) |>
  dplyr::mutate(pair_type = "discovery" |> factor())
to_plot <- rbind(undercover_ss, discovery_ss)

```

Below are boxplots/violin plots of the number of nonzero treatment cells per pair, stratified by dataset (i.e., Frangieh control, Papalexi gene) and pair type (i.e., negative control, discovery). Visually, we see that the discovery pairs have a greater number of nonzero treatment cells.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = to_plot, aes(x = pair_type, y = n_nonzero_treatment)) +
  facet_wrap(facets = dataset ~ ., scales = "free_y") +
  geom_boxplot(outlier.size = 0) +
  geom_violin() + xlab("Pair type") + ylab("N nonzero treatment")
```

I compute the mean and median number of nonzero treatment cells in each of these four categories.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
to_plot |>
  dplyr::group_by(dataset, pair_type) |>
  dplyr::summarize(mean_n_nonzero_trt = mean(n_nonzero_treatment),
                   median_n_nonzero_trt = median(n_nonzero_treatment))
```

We see that the discovery pairs have roughly twice as many nonzero treatment cells as the negative control pairs.
